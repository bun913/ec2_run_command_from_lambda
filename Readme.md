# StepFunctionsで色々なものを呼び出して遊ぶ

以下のようなある種あるあるな状態を想定。

できるだけ既存のアーキテクチャを変えずに、楽に一連の機能を作成したい
## 概要

とあるバッチ処理用EC2インスタンスに関しては、ローカルストレージもガンガン使っていて、各種処理も密結合になっている。
（古くからいろいろなバッチ処理を継ぎ足している状態)

特に密結合と評判なのが マスタデータの取り込み処理

- S3に配置されたファイルを取得
- バリデーションを行なって
- 問題なければETL処理をして
- DBに取り込み処理をする

という一連の処理がこの手順通りにしか行えない。

言い換えれば、ただ単に「バリデーションだけしてデータを取り込める形かどうか」という判定をすることができない状態。

この状態を改善するべく運用が開発に相談を持ちかける

## 改善要望

### どんな機能が必要か

- バリデーション処理だけを行えるようにコードを素結合にする
- 既存のアーキテクチャ(S3・EC2等)は変えずに
  - S3にマスタファイルが配置される
  - 配置を検知して、バリデーションを行う
  - どこがどうまずいのか、Slackで通知する

という処理が必要

### なぜ必要なのか

- リードタイムが長い
  - S3にマスタファイルを配置してもらったことを教えてもらう
  - EC2インスタンスにログインして処理を実行
  - その結果取り込めたら各種パラメーターの調整などを行う
  - 取り込めない場合もログを見てからどこが悪いか調査する必要がある
  - ↑のフローに時間がかかる
- マスタが取り込めない場合エラーログに出力され、マネージャーも見ているSlackにアラートが飛ばされる
  - 単純にエラーがポンポンでるので精神衛生上良く無い

## IaC

Terraformの1.0.8を利用して各種モジュールを整える

