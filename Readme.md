# StepFunctionsで色々なものを呼び出して遊ぶ

## レシピ概要

今回は結構現場に残っている「バッチ処理用のEC2インスタンス」を使ったお料理になります。

このバッチ処理用EC2インスタンスに関しては、ローカルストレージもガンガン使っていて、各種処理も密結合になっていて、まさに秘伝のタレ状態。

特に密結合でうざいと評判なのが

- マスタデータの取り込み処理
  - S3に配置された
  - バリデーションをして
  - ETL処理をして
  - DBに取り込み処理をする

という処理が密結合になっている状態。

つまり、ただ単に「バリデーションだけしてデータを取り込める形かどうか」という判定をすることができない状態。

この状態を改善するべく運用が開発に相談を持ちかける

## 運用くんの要望

### どんな機能が必要か

- バリデーション処理だけを行えるようにコードを素結合にする
- 既存のアーキテクチャ(S3・EC2等)は変えずに
  - S3にマスタファイルが配置される
  - 配置を検知して、バリデーションを行う
  - どこがどうまずいのか、Slackで通知する

という処理が必要

### なぜ必要なのか

- リードタイムが長い
  - S3にマスタファイルを配置してもらったことを教えてもらう
  - EC2インスタンスにログインして処理を実行
  - その結果取り込めたら各種パラメーターの調整などを行う
  - 取り込めない場合もログを見てからどこが悪いか調査する必要がある
  - ↑のフローに時間がかかる
- マスタが取り込めない場合エラーログに出力され、マネージャーも見ているSlackにアラートが飛ばされる
  - 単純にエラーがポンポンでるので精神衛生上良く無い

この辺のことを改善する必要があるため。

## 開発くんがやること

